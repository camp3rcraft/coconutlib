# Установка и настройка CoconutLib

## Требования

### Системные требования
- **Java**: 17 или выше
- **Minecraft**: Paper 1.21.4
- **Память**: Минимум 2GB RAM для сервера
- **Дисковое пространство**: 100MB свободного места

### Зависимости
- **Paper 1.21.4** - основной сервер
- **SQLite** - встроенная база данных (включена в библиотеку)

## Установка

### Шаг 1: Подготовка сервера
1. Убедитесь, что у вас установлен Paper 1.21.4
2. Создайте резервную копию вашего сервера
3. Остановите сервер

### Шаг 2: Установка CoconutLib
1. Скачайте `CoconutLib-1.0.0.jar` из релизов
2. Поместите файл в папку `plugins/` вашего сервера
3. Запустите сервер

### Шаг 3: Первоначальная настройка
1. После первого запуска в папке `plugins/CoconutLib/` создастся конфигурация
2. Отредактируйте файл `config.yml` под ваши нужды
3. Перезапустите сервер

## Конфигурация

### Основные настройки

#### База данных
```yaml
database:
  type: "sqlite"
  sqlite:
    file: "arenas.db"
```

#### Миры
```yaml
worlds:
  default_environment: "NORMAL"  # NORMAL, NETHER, THE_END
  seed: 0                       # Сид для генерации миров
  generate_structures: false     # Генерировать ли структуры
```

#### Скорборды
```yaml
scoreboard:
  enabled: true
  title: "§6§lАРЕНА"
  lobby: "§aЛобби"
  waiting: "§eОжидание игроков"
  countdown: "§6Ожидание начала"
  game: "§cИгра"
  end: "§4Конец"
```

#### Табы
```yaml
tab:
  enabled: true
  header: "§6§lАРЕНА"
  footer: "§7Игроков на арене: §e%players%"
```

#### Инвентари
```yaml
inventory:
  clear_on_leave: true    # Очищать инвентарь при выходе
  save_on_join: true      # Сохранять инвентарь при входе
```

#### Сообщения
```yaml
messages:
  prefix: "§8[§6CoconutLib§8] §r"
  arena_created: "§aАрена §e%arena% §aсоздана!"
  arena_deleted: "§cАрена §e%arena% §cудалена!"
  arena_joined: "§aВы присоединились к арене §e%arena%"
  arena_left: "§cВы покинули арену §e%arena%"
  arena_not_found: "§cАрена §e%arena% §cне найдена!"
  arena_already_exists: "§cАрена §e%arena% §cуже существует!"
  arena_regenerated: "§aАрена §e%arena% §aрегенерирована!"
```

## Команды

### Административные команды
- `/arena create <название> [макс_игроков] [мин_игроков]` - Создать арену
- `/arena delete <название>` - Удалить арену
- `/arena regenerate <название>` - Регенерировать арену
- `/arena status <название> <статус>` - Изменить статус арены

### Команды для игроков
- `/arena list` - Список арен
- `/arena join <название>` - Присоединиться к арене
- `/arena leave` - Покинуть арену
- `/arena info <название>` - Информация об арене

### Права доступа
- `coconutlib.arena.admin` - Полный доступ к управлению аренами
- `coconutlib.arena.join` - Возможность присоединяться к аренам
- `coconutlib.arena.leave` - Возможность покидать арены

## Создание плагина с CoconutLib

### Шаг 1: Создание проекта
1. Создайте новый Gradle проект
2. Добавьте зависимость на CoconutLib

```kotlin
// build.gradle.kts
dependencies {
    compileOnly("io.papermc.paper:paper-api:1.21.4-R0.1-SNAPSHOT")
    compileOnly(files("path/to/CoconutLib.jar"))
}
```

### Шаг 2: Основной класс плагина
```java
public class MyMinigame extends JavaPlugin {
    
    private CoconutLib coconutLib;
    
    @Override
    public void onEnable() {
        coconutLib = (CoconutLib) getServer().getPluginManager().getPlugin("CoconutLib");
        
        if (coconutLib == null) {
            getLogger().severe("CoconutLib не найден!");
            getServer().getPluginManager().disablePlugin(this);
            return;
        }
        
        // Ваша логика здесь
    }
}
```

### Шаг 3: plugin.yml
```yaml
name: MyMinigame
version: '1.0.0'
main: com.example.myplugin.MyMinigame
api-version: '1.21'
depend: [CoconutLib]
```

## Устранение неполадок

### Частые проблемы

#### CoconutLib не загружается
- Проверьте версию Java (должна быть 17+)
- Убедитесь, что используете Paper 1.21.4
- Проверьте логи сервера на ошибки

#### Ошибки с базой данных
- Убедитесь, что у сервера есть права на запись в папку plugins/CoconutLib/
- Проверьте, что файл arenas.db не поврежден
- Попробуйте удалить файл arenas.db и перезапустить сервер

#### Проблемы с мирами
- Убедитесь, что у сервера достаточно памяти
- Проверьте права на создание файлов в папке worlds/
- Убедитесь, что имя мира не содержит специальных символов

#### Скорборды не отображаются
- Проверьте настройку `scoreboard.enabled: true`
- Убедитесь, что у игроков есть права на просмотр скорбордов
- Проверьте, что нет конфликтов с другими плагинами

### Логи и отладка

#### Включение отладочных сообщений
Добавьте в `server.properties`:
```properties
debug=true
```

#### Просмотр логов
- Логи сервера: `logs/latest.log`
- Логи CoconutLib: `plugins/CoconutLib/logs/`

#### Проверка состояния
```bash
# Проверка версии Java
java -version

# Проверка свободного места
df -h

# Проверка прав доступа
ls -la plugins/CoconutLib/
```

## Обновление

### Автоматическое обновление
1. Скачайте новую версию CoconutLib
2. Остановите сервер
3. Замените старый jar файл новым
4. Запустите сервер

### Ручное обновление
1. Создайте резервную копию папки `plugins/CoconutLib/`
2. Удалите старую версию
3. Установите новую версию
4. Скопируйте настройки из резервной копии

## Производительность

### Рекомендации
- **RAM**: Минимум 2GB для сервера с CoconutLib
- **CPU**: 2+ ядра для стабильной работы
- **Диск**: SSD рекомендуется для лучшей производительности БД

### Оптимизация
- Отключите ненужные функции в config.yml
- Используйте асинхронные операции для тяжелых задач
- Ограничьте количество одновременных арен
- Регулярно очищайте неиспользуемые данные

### Мониторинг
- Следите за использованием памяти
- Проверяйте размер файла базы данных
- Мониторьте количество активных арен
- Отслеживайте время отклика команд

## Безопасность

### Права доступа
- Ограничьте доступ к административным командам
- Используйте группы для управления правами
- Регулярно проверяйте права доступа

### Защита данных
- Регулярно создавайте резервные копии
- Защитите доступ к папке plugins/CoconutLib/
- Используйте SSL для удаленного доступа

### Аудит
- Включите логирование всех действий
- Регулярно проверяйте логи на подозрительную активность
- Настройте уведомления о критических событиях 